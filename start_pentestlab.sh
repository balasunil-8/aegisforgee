#!/bin/bash

# PentestLab Enterprise v2.0 - Deployment & Startup Script
# Run this to start the vulnerable API for testing

echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo "  üî¥ PentestLab Enterprise v2.0 - Startup"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo ""

# Check Python installation
if ! command -v python3 &> /dev/null; then
    echo "‚ùå Python 3 not found. Installing..."
    # Installation instructions for different OS
    if [[ "$OSTYPE" == "linux-gnu"* ]]; then
        sudo apt-get update && sudo apt-get install python3 python3-pip
    elif [[ "$OSTYPE" == "darwin"* ]]; then
        brew install python3
    elif [[ "$OSTYPE" == "msys" ]]; then
        echo "Please install Python 3 from https://www.python.org"
        exit 1
    fi
fi

echo "‚úì Python 3 detected"
echo ""

# Check if in correct directory
if [ ! -f "pentestlab_api.py" ]; then
    echo "‚ùå Error: pentestlab_api.py not found"
    echo "Run this script from the PentestLab root directory"
    exit 1
fi

echo "Step 1/4: Create virtual environment"
python3 -m venv venv
source venv/bin/activate

echo "‚úì Virtual environment created"
echo ""

echo "Step 2/4: Install dependencies"
pip install --upgrade pip
pip install -r requirements.txt

echo "‚úì Dependencies installed"
echo ""

echo "Step 3/4: Initialize database"
python3 << 'EOF'
from pentestlab_api import app, db
with app.app_context():
    db.create_all()
    print("‚úì Database initialized")
EOF

echo ""
echo "Step 4/4: Starting API server"
echo ""
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo "  üöÄ API Running on http://localhost:5000"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo ""
echo "üìå IMPORTANT NOTES:"
echo ""
echo "  ‚Ä¢ This is an INTENTIONALLY VULNERABLE application"
echo "  ‚Ä¢ Use for authorized testing ONLY"
echo "  ‚Ä¢ Never deploy to production"
echo "  ‚Ä¢ Access logs are recorded"
echo ""
echo "üìö QUICK START:"
echo ""
echo "  1. Import Postman Collection:"
echo "     PENTESTLAB_POSTMAN_COLLECTION.json"
echo ""
echo "  2. Read Testing Guide:"
echo "     PENTESTLAB_TESTING_GUIDE.md"
echo ""
echo "  3. Useful URLs:"
echo "     Dashboard:        http://localhost:5000"
echo "     Health Check:     http://localhost:5000/api/health"
echo "     Vulnerabilities:  http://localhost:5000/api/vulnerabilities/list"
echo ""
echo "  4. Testing Tools:"
echo "     Postman:  Import the collection file"
echo "     SQLMap:   sqlmap -u 'http://localhost:5000/api/injection/sqli/boolean?username=1'"
echo "     Burp:     Add http://localhost:5000 as target"
echo "     ZAP:      Configure proxy to localhost:5000"
echo ""
echo "Press CTRL+C to stop"
echo ""

python3 pentestlab_api.py
