@echo off
REM PentestLab Enterprise v2.0 - Windows Startup Script

echo ============================================================
echo   PentestLab Enterprise v2.0 - Startup
echo ============================================================
echo.

REM Check Python installation
python --version >nul 2>&1
if errorlevel 1 (
    echo ! Python not found. Installing...
    echo Please download Python from https://www.python.org
    echo Then add Python to PATH and run this script again
    pause
    exit /b 1
)

echo - Python detected
echo.

REM Check if in correct directory
if not exist "pentestlab_api.py" (
    echo ! Error: pentestlab_api.py not found
    echo Run this script from the PentestLab root directory
    pause
    exit /b 1
)

echo Step 1/4: Create virtual environment
python -m venv venv
call venv\Scripts\activate.bat

echo - Virtual environment created
echo.

echo Step 2/4: Install dependencies
python -m pip install --upgrade pip
pip install -r requirements.txt

echo - Dependencies installed
echo.

echo Step 3/4: Initialize database
python << "EOF"
from pentestlab_api import app, db
with app.app_context():
    db.create_all()
    print("- Database initialized")
EOF

echo.
echo Step 4/4: Starting API server
echo.
echo ============================================================
echo   API Running on http://localhost:5000
echo ============================================================
echo.
echo IMPORTANT NOTES:
echo.
echo   * This is an INTENTIONALLY VULNERABLE application
echo   * Use for authorized testing ONLY
echo   * Never deploy to production
echo   * Access logs are recorded
echo.
echo QUICK START:
echo.
echo   1. Import Postman Collection:
echo      PENTESTLAB_POSTMAN_COLLECTION.json
echo.
echo   2. Read Testing Guide:
echo      PENTESTLAB_TESTING_GUIDE.md
echo.
echo   3. Useful URLs:
echo      Dashboard:        http://localhost:5000
echo      Health Check:     http://localhost:5000/api/health
echo      Vulnerabilities:  http://localhost:5000/api/vulnerabilities/list
echo.
echo   4. Testing Tools:
echo      Postman:  Import the collection file
echo      Burp:     Add http://localhost:5000 as target
echo      ZAP:      Configure proxy to localhost:5000
echo.
echo Press CTRL+C to stop
echo.

python pentestlab_api.py

pause
